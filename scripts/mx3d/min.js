/* Wed Jun 25 20:31:42 CST 2014 */
/* Generated by MagicCube MXBuild with MXFramework */
$ns("mx3d.util");
mx3d.util.ShaderMaterialBuilder=function(){function a(b,a){return"number"===typeof b?"f":b instanceof THREE.Color?"c":b instanceof THREE.Texture?"t":a}var c=$extend(MXObject),b={};c.url=null;c.parameters={};c.attributes={};c.uniforms={};var l=null,d=null;b._=c._;c._=function(a){c.canConstruct()&&(b._(a),null!=a&&null!=a.uniforms&&(c.uniforms=$.extend(a.uniforms,c.uniforms)),null!=a&&null!=a.attributes&&(c.attributes=$.extend(a.attributes,c.attributes)),null!=c.url&&c.loadXML(c.url))};c.loadXML=function(b){c.url=
b;$.ajax({dataType:"xml",url:b,async:!1}).success(function(b){b=$(b);l=b.find("material \x3e script[id\x3dvertexShader]").text();d=b.find("material \x3e script[id\x3dfragmentShader]").text()})};c.setAttributeValues=function(b,e,l){var d=l;null==l&&(d=a(e[0]));c.attributes[b]={t:d,value:e}};c.setAttributeValue=function(b,e,l){null==c.attributes[b]&&c.setAttributeValues(b,[],a(e,l));c.attributes[b].value.add(e)};c.setUniformValue=function(b,e,l){var d=l;null==l&&(d=a(e));e={type:d,value:e};return c.uniforms[b]=
e};c.build=function(){var b=$.extend({},c.parameters);b.attributes=$.extend({},c.attributes);b.uniforms=$.extend({},c.uniforms);b.vertexShader=l;b.fragmentShader=d;return new THREE.ShaderMaterial(b)};return c.endOfClass(arguments)};mx3d.util.ShaderMaterialBuilder.className="mx3d.util.ShaderMaterialBuilder";$ns("mx3d.view");$import("lib.tween.Tween");$import("lib.threejs.three",function(){$import("lib.threejs.plugins.stats");$import("lib.threejs.controls.TrackballControls")});$import("mx3d.view.Scene3DView");
mx3d.view.AnimatedScene3DView=function(){var a=$extend(mx3d.view.Scene3DView),c={};a.cameraControlsEnabled=!1;a.statsVisible=!1;a.animating=!0;a.playState=null;a.frameIndex=0;a.stats=null;a.cameraControls=null;a.onframing=null;c.init=a.init;a.init=function(b){c.init(b);a.$element.addClass("AnimatedScene3DView")};c.init3D=a.init3D;a.init3D=function(){c.init3D();a.initStats();a.initControls()};a.initControls=function(){a.initCameraControls()};a.initCameraControls=function(){a.cameraControlsEnabled&&
null==a.cameraControls&&(a.cameraControls=new THREE.TrackballControls(a.camera,a.$element.find("canvas")[0]))};a.initStats=function(){a.statsVisible&&null==a.stats&&(a.stats=new Stats,a.stats.domElement.style.position="absolute",a.stats.domElement.style.right="5px",a.stats.domElement.style.bottom="5px",a.stats.domElement.style.whiteSpace="nowrap",a.$container.append(a.stats.domElement))};a.startAnimation=function(){a.animating=!0;a.renderLoop()};a.stopAnimation=function(){a.animating=!1};a.renderLoop=
function(){a.trigger("framing");a.cameraControlsEnabled?(null==a.cameraControls&&a.initCameraControls(),a.cameraControls.enabled||(a.cameraControls.enabled=!0),a.cameraControls.update()):null!=a.cameraControls&&a.cameraControls.enabled&&(a.cameraControls.enabled=!1);a.update();a.render();a.statsVisible&&(null==a.stats&&a.initStats(),a.stats.update());a.animating&&requestAnimationFrame(a.renderLoop)};a.moveCamera=function(b,c,d,h){var e=$.Deferred();null==d&&(d=1E3);a.cameraControlsEnabled=!1;null!=
b&&(new TWEEN.Tween(a.camera.position)).to(b,d).easing(TWEEN.Easing.Sinusoidal.Out).start();null!=c&&(new TWEEN.Tween(a.camera.rotation)).to(c,d).easing(TWEEN.Easing.Sinusoidal.Out).start();null!=h?(new TWEEN.Tween(a.cameraControls.object.up)).to(h,d).easing(TWEEN.Easing.Sinusoidal.Out).start():a.cameraControls.reset();setTimeout(function(){a.cameraControlsEnabled=!0;e.resolve()},d);return e};a.moveCameraTarget=function(b,c){var d=$.Deferred();if(null!=b){var h=c;null==h&&(h=1E3);a.cameraControlsEnabled=
!1;(new TWEEN.Tween(a.cameraControls.target)).to(b,h).easing(TWEEN.Easing.Sinusoidal.Out).onComplete(function(){a.cameraControlsEnabled=!0;d.resolve()}).start()}else d.resolve();return d};a.focusLine=function(b,c,d,h,e){var p=$.Deferred(),m=null,g=null,m=null;null==h&&(h=1E3);null==e&&(e=!1);if(e){m=new THREE.LineBasicMaterial({color:16777215});g=new THREE.Geometry;g.vertices.push(b);g.vertices.push(c);m=new THREE.Line(g,m);a.addObject(m);var f=new THREE.CubeGeometry(80,80,80),f=new THREE.Mesh(f);
f.position.copy(c);a.addObject(f)}var f=b.clone(),f=f.lerp(c,0.5),k=new THREE.Vector3;k.subVectors(c,b);b=k.length();c=new THREE.Quaternion;m=new THREE.Vector3(0,0,1);c.setFromAxisAngle(m,-Math.PI/2);k.applyQuaternion(c);b=0.5*b*Math.tan((90-a.camera.fov/2)*Math.PI/180);k.normalize().multiplyScalar(b);k.z=b*Math.tan(d*Math.PI/180);k.add(f);e&&(m=new THREE.LineBasicMaterial({color:16777215}),g=new THREE.Geometry,g.vertices.push(f),g.vertices.push(k),m=new THREE.Line(g,m),a.addObject(m));a.cameraControlsEnabled&&
null!=a.cameraControls&&(a.cameraControlsEnabled=!1,d=h,(new TWEEN.Tween(a.cameraControls.target)).to(f,d).easing(TWEEN.Easing.Sinusoidal.Out).start(),(new TWEEN.Tween(a.camera.position)).to(k,d).easing(TWEEN.Easing.Sinusoidal.Out).onUpdate(function(){a.camera.lookAt(a.cameraControls.target)}).start(),(new TWEEN.Tween(a.cameraControls.object.up)).to({x:0,y:0,z:1},d).easing(TWEEN.Easing.Sinusoidal.Out).start(),setTimeout(function(){a.cameraControlsEnabled=!0;p.resolve()},d));return p};a.focusTriangle=
function(b,c,d,h,e,p){var m=$.Deferred(),g=null,f=null,g=null;null==e&&(e=1E3);null==p&&(p=!1);if(p){g=new THREE.LineBasicMaterial({color:16777215});f=new THREE.Geometry;f.vertices.push(b);f.vertices.push(c);f.vertices.push(d);f.vertices.push(b);g=new THREE.Line(f,g);a.addObject(g);var k=new THREE.CubeGeometry(80,80,80),k=new THREE.Mesh(k);k.position.copy(c);a.addObject(k)}var k=b.clone(),k=k.lerp(c,0.5),n=new THREE.Vector3;n.subVectors(c,b);b=n.length();c=new THREE.Quaternion;g=new THREE.Vector3(0,
0,1);c.setFromAxisAngle(g,-Math.PI/2);n.applyQuaternion(c);c=(90-a.camera.fov/2)*Math.PI/180;h=h*Math.PI/180;b=0.5*b*Math.tan(c);d=(Math.abs(d.z)+100)*(Math.sin(h)+Math.cos(h)*Math.tan(c))*Math.cos(h);d=b>d?b:d;n.normalize().multiplyScalar(d);n.z=d*Math.tan(h);n.add(k);p&&(g=new THREE.LineBasicMaterial({color:16777215}),f=new THREE.Geometry,f.vertices.push(k),f.vertices.push(n),g=new THREE.Line(f,g),a.addObject(g));a.cameraControlsEnabled&&null!=a.cameraControls&&(a.cameraControlsEnabled=!1,(new TWEEN.Tween(a.cameraControls.target)).to(k,
e).easing(TWEEN.Easing.Sinusoidal.Out).start(),(new TWEEN.Tween(a.camera.position)).to(n,e).easing(TWEEN.Easing.Sinusoidal.Out).onUpdate(function(){a.camera.lookAt(a.cameraControls.target)}).start(),(new TWEEN.Tween(a.cameraControls.object.up)).to({x:0,y:0,z:1},e).easing(TWEEN.Easing.Sinusoidal.Out).start(),setTimeout(function(){a.cameraControlsEnabled=!0;m.resolve()},e));return m};c.update=a.update;a.update=function(b){TWEEN.update();c.update(b)};return a.endOfClass(arguments)};
mx3d.view.AnimatedScene3DView.className="mx3d.view.AnimatedScene3DView";$ns("mx3d.view");
mx3d.view.LabelView=function(){var a=$extend(mx.view.View),c={};a.position=null;a.text=null;a.fontSize=16;a.camera=null;a.projector=null;a.clickable=!1;c.init=a.init;a.init=function(b){c.init(b);a.$container.addClass("LabelView");a.$container.css({position:"absolute"});a.clickable&&a.$container.css("cursor","pointer");null!=a.text&&a.setText(a.text)};a.setText=function(b){a.text=b;a.$container.text(null!=a.text?a.text:"")};a.setHtml=function(b){a.$container.html(null!=b?b:"");a.text=a.$container.text()};
a.update=function(){var b=a.position.clone();a.projector.projectVector(b,a.camera);var c=b.z;a.setFrame({left:(b.x+1)/2*a.projector.frame.width,top:-(b.y-1)/2*a.projector.frame.height});1>c?a.$container.css({display:"block",fontSize:a.fontSize/4*50*(1-c)}):a.$container.css({display:"none"})};return a.endOfClass(arguments)};mx3d.view.LabelView.className="mx3d.view.LabelView";$ns("mx3d.view");mx3d.view.MXComponent3D=function(){var a=$extend(MXComponent),c={};a.id=null;a.object3D=null;a.parentView=null;a.parentObject3D=null;a.needsUpdate=!1;c.init=a.init;a.init=function(b){c.init(b);null==a.object3D&&a.initObject3D();null!=a.object3D&&(a.object3D.id=a.id)};a.initObject3D=function(){a.object3D=new THREE.Object3D};a.addObject=function(b){a.object3D.add(b)};a.removeObject=function(b){a.object3D.remove(b)};a.update=function(b){};return a.endOfClass(arguments)};
mx3d.view.MXComponent3D.className="mx3d.view.MXComponent3D";$ns("mx3d.view");mx3d.view.MXObject3D=function(){var a=$extend(MXComponent),c={};a.id=null;a.object3D=null;a.parentView=null;a.parentObject3D=null;a.needsUpdate=!1;c.init=a.init;a.init=function(b){c.init(b);null==a.object3D&&a.initObject3D();null!=a.object3D&&(a.object3D.id=a.id)};a.initObject3D=function(){a.object3D=new THREE.Object3D};a.addObject=function(b){a.object3D.add(b)};a.removeObject=function(b){a.object3D.remove(b)};a.update=function(b){};return a.endOfClass(arguments)};
mx3d.view.MXObject3D.className="mx3d.view.MXObject3D";$ns("mx3d.view");
$import("lib.threejs.three",function(){$import("lib.threejs.effects.AnaglyphEffect");$import("lib.threejs.shaders.ColorCorrectionShader");$import("lib.threejs.shaders.CopyShader");$import("lib.threejs.shaders.BokehShader");$import("lib.threejs.shaders.DotScreenShader");$import("lib.threejs.shaders.FXAAShader");$import("lib.threejs.shaders.HorizontalTiltShiftShader");$import("lib.threejs.shaders.RGBShiftShader");$import("lib.threejs.shaders.ShaderExtras");$import("lib.threejs.shaders.SSAOShader");$import("lib.threejs.shaders.VerticalTiltShiftShader");
$import("lib.threejs.shaders.VignetteShader");$import("lib.threejs.postprocessing.EffectComposer");$import("lib.threejs.postprocessing.BokehPass");$import("lib.threejs.postprocessing.MaskPass");$import("lib.threejs.postprocessing.RenderPass");$import("lib.threejs.postprocessing.SavePass");$import("lib.threejs.postprocessing.ShaderPass");$import("lib.threejs.plugins.DepthPassPlugin")});$import("mx3d.view.LabelView");$include("mx3d.res.Scene3DView.css");
mx3d.view.Scene3DView=function(){function a(a){if(b.clickable&&a.target===b.renderer.domElement&&(a.preventDefault(),0===a.button)){var c=0,d=0,c=2*(a.clientX/b.frame.width)-1,d=2*-(a.clientY/b.frame.height)+1,c=new THREE.Vector3(c,d,1);(new THREE.Projector).unprojectVector(c,b.camera);a=b.camera.position;c=c.sub(b.camera.position).normalize();d=new THREE.Raycaster;d.set(a,c);a=d.intersectObjects(b.clickableObjects);0<a.length&&(c=a.map(function(b){return b.object}),b.trigger("objectclick",{objects:c,
intersects:a}))}}function c(a){0===a.button&&b.trigger("labelviewclick",{labelView:b.subviews[a.currentTarget.id]})}var b=$extend(mx.view.View);b.frame={width:window.innerWidth,height:window.innerHeight};var l={};b.scene=null;b.camera=null;b.cameraParams=null;b.renderMode="renderer";b.renderer=null;b.rendererParams=null;b.clickable=!1;b.clickableObjects=[];b.anaglyphEffectEnabled=!1;b.displayAnalyphEffectButton=!1;b.labelViews=[];b.$anaglyphEffectButton=null;b.onobjectclick=null;b.onlabelviewclick=
null;l.init=b.init;b.init=function(h){l.init(h);b.init3D();b.$element.addClass("Scene3DView");b.$element.css("overflow","hidden");b.$element.on("mouseup",a);b.$element.on("click",".LabelView",c)};b.init3D=function(){b.initScene();b.initCamera();b.initRenderer();b.initEffects();b.initObjects();b.initLights();b.displayAnalyphEffectButton&&b.initAnalyEffectButton()};b.initScene=function(){b.scene=new THREE.Scene};b.initCamera=function(){var a=$.extend({fov:45,aspect:b.frame.width/b.frame.height,near:0.01,
far:1E4},b.cameraParams);b.camera=new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far);if(null!=a.position)if(isArray(a.position))b.camera.position.fromArray(a.position);else{var c=$.extend({x:0,y:0,z:0},a.position);b.camera.position.copy(c)}null!=a.rotation&&(isArray(a.rotation)?b.camera.rotation.fromArray(a.rotation):(a=$.extend({x:0,y:0,z:0},a.rotation),b.camera.rotation.copy(a)));b.addObject(b.camera)};b.initRenderer=function(){var a=$.extend({antialias:!0},b.rendererParams);b.renderer=new THREE.WebGLRenderer(a);
b.renderer.setSize(b.frame.width,b.frame.height);b.renderer.gammaInput=!0;b.renderer.gammaOutput=!0;b.renderer.physicallyBasedShading=!0;b.renderer.shadowMapEnabled=!0;b.renderer.shadowMapSoft=!0;b.$container.append(b.renderer.domElement);"composer"===b.renderMode&&b.initComposer()};b.initComposer=function(){b.composer=new THREE.EffectComposer(b.renderer)};b.initEffects=function(){b.anaglyphEffectEnabled&&null==b.anaglyphEffect&&(b.anaglyphEffect=new THREE.AnaglyphEffect(b.renderer),b.anaglyphEffect.setSize(b.frame.width,
b.frame.height))};b.initAnalyEffectButton=function(){b.$anaglyphEffectButton=$("\x3cdiv id\x3danalyphEffect/\x3e");b.$anaglyphEffectButton.on("click",function(a){0===a.button&&(a.preventDefault(),b.anaglyphEffectEnabled=!b.anaglyphEffectEnabled,b.$anaglyphEffectButton.toggleClass("enabled",b.anaglyphEffectEnabled))});b.$container.append(b.$anaglyphEffectButton)};b.initObjects=function(){};b.initLights=function(){};b.addObject=function(a){b.scene.add(a)};b.removeObject=function(a){b.scene.remove(a)};
b.addLight=function(a,c){b.scene.add(a);if(null!=c){var d=null,d=new c(a);b.addObject(d)}};b.removeLight=function(a){b.scene.remove(a)};b.render=function(){b.anaglyphEffectEnabled?(null==b.anaglyphEffect&&b.initEffects(),b.anaglyphEffect.render(b.scene,b.camera)):"composer"===b.renderMode&&null!=b.composer?b.composer.render():b.renderer.render(b.scene,b.camera)};b.update=function(a){b.updateLabels(a)};b.updateLabels=function(a){b.labelViews.forEach(function(b){b.update(a)})};l.setFrame=b.setFrame;
b.setFrame=function(a){l.setFrame(a);if("number"===typeof a.width||"number"===typeof a.height)null!=b.camera&&(b.camera.aspect=b.frame.width/b.frame.height,b.camera.updateProjectionMatrix()),b.update(),null!=b.renderer&&b.renderer.setSize(b.frame.width,b.frame.height),null!=b.anaglyphEffect&&b.anaglyphEffect.setSize(b.frame.width,b.frame.height)};var d=null;b.addLabelView=function(a){null==d&&(d=new THREE.Projector,d.frame=b.frame);a=$.extend({camera:b.camera,projector:d},a);a=new mx3d.view.LabelView(a);
b.addSubview(a);b.labelViews.add(a);a.update();return a};b.removeLabelView=function(a){b.removeSubview(a);a.camera=null;a.projector=null;b.labelViews.remove(a)};b.clearLabelViews=function(){b.labelViews.forEach(function(a){b.removeSubview(a)})};return b.endOfClass(arguments)};mx3d.view.Scene3DView.className="mx3d.view.Scene3DView";